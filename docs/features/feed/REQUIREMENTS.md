# 要件定義書: Feed（フィード画面）

> 生成日時: 2026-02-27
> ステータス: Draft

## 1. 概要

他ユーザーが作成した短歌カードが流れるメインフィード画面。短歌カードのフリップ表示、いいね、通報・ブロック、悩み入力画面への遷移、短歌生成結果の表示を包括する。

## 2. 背景

こころうたのメイン画面として、ユーザーが他の人の短歌を閲覧し、共感を伝える場を提供する。カードをタップすると裏返って短歌が読める UI が特徴。

## 3. スコープ

### 含むもの

- フィード画面（短歌カード一覧、無限スクロール、プルリフレッシュ）
- いいね機能（トグル）
- 通報シート（S-006）
- ブロック確認ダイアログ（S-007）
- FAB（今日の短歌を詠むボタン）
- 悩み入力画面（S-002）
- 短歌生成結果画面（S-003）
- フィードタブ内のナビゲーション（FeedNavigationView）
- ContentView の更新（プレースホルダーを実画面に置換）

### 含まないもの

- マイ短歌履歴画面（S-004）→ MyTanka フィーチャーで実装
- 設定画面（S-005）→ Settings フィーチャーで実装
- ブロックリスト画面（S-009）→ Settings フィーチャーで実装
- アカウント削除画面（S-008）→ Settings フィーチャーで実装

## 4. 機能要件

### FR-001: フィード表示

- 起動時にフィードを取得し、短歌カードを一覧表示する
- カードは `TankaCard` コンポーネントを使用する
- カードタップでフリップ（悩み → 短歌の縦書き表示）

### FR-002: 無限スクロール

- 最後のカード付近までスクロールしたら次ページを自動読み込みする
- `FeedResponse.hasMore` と `nextCursor` を利用する

### FR-003: プルリフレッシュ

- 下方向にプルしてフィードを最新データで更新する

### FR-004: いいね

- いいねボタンタップでトグル（like / unlike）
- API レスポンスの `likeCount` でカウントを更新する

### FR-005: 通報

- カード長押し → コンテキストメニュー → 「通報する」
- 通報理由選択シートを表示（不適切な内容 / スパム / その他）
- 送信後、確認メッセージを表示する

### FR-006: ブロック

- カード長押し → コンテキストメニュー → 「ブロックする」
- 確認アラートを表示し、確定でブロック API を呼ぶ
- ブロック後、該当ユーザーのカードをフィードから除去する

### FR-007: FAB（悩み入力への遷移）

- 画面右下に FAB を表示
- タップで悩み入力画面に遷移
- 本日の短歌作成済みの場合は無効化（サーバー側で制御、`rateLimited` エラーをハンドリング）

### FR-008: 悩み入力

- カテゴリを4つから1つ選択する
- テキストを10〜200文字で入力する
- バリデーション通過後「短歌を詠む」で短歌生成画面に遷移する

### FR-009: 短歌生成結果表示

- 画面表示時に自動で短歌生成 API を呼ぶ
- 生成中はローディング表示
- 生成完了で `TankaCard` を表示する
- 「フィードに戻る」でルートに戻る

## 5. 非機能要件

- ローディング・エラー・空データの各状態を適切に表示する
- 通報・ブロック操作後のフィードバックを表示する

## 6. 受け入れ条件

- [ ] フィード画面が表示され、短歌カードが一覧される
- [ ] カードタップでフリップアニメーションが動作する
- [ ] いいねのトグルが動作する
- [ ] 無限スクロールでページネーションが動作する
- [ ] プルリフレッシュでフィードが更新される
- [ ] 長押しで通報・ブロックメニューが表示される
- [ ] 通報シートで理由を選択して送信できる
- [ ] ブロック確認後、該当ユーザーの短歌が非表示になる
- [ ] FAB から悩み入力画面に遷移できる
- [ ] カテゴリ選択 + テキスト入力 → 短歌生成が動作する
- [ ] 短歌生成結果がカード形式で表示される
- [ ] 各エラー状態が正しく表示される
- [ ] ビルドが通る
