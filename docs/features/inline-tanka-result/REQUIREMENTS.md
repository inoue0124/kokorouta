# 要件定義書: 短歌生成結果の同一画面内アニメーション表示

> Issue: #16
> 生成日時: 2026-02-27
> ステータス: Draft

## 1. 概要

短歌生成後の結果表示を、ナビゲーション遷移（別ページ）から同一画面内のアニメーション表示に変更する。
入力 → 生成中 → 結果表示の状態遷移をすべて ComposeView 内で完結させ、短歌が「詠まれた」瞬間の情緒的な体験を提供する。

## 2. 背景・動機

- 現在はナビゲーションで `TankaResultView` に遷移しているため、体験が途切れる
- 同一画面内でふわっとしたエフェクト付き表示にすることで、短歌が生まれる瞬間の演出を強化する
- ページ遷移のない一体感のある UX を実現する

## 3. 機能要件

### FR-1: 同一画面内の結果表示

- 「短歌を詠む」ボタンタップ後、ナビゲーション遷移せずに同一画面内で状態が切り替わる
- 入力フォーム部分がフェードアウトし、結果表示部分がフェードインする

### FR-2: アニメーションエフェクト

- 結果表示時にふわっとしたフェードインアニメーションがかかる
- 短歌テキストは **5-7-5-7-7 の句ごとに順番にフェードイン**する
  - 各句が `opacity` + `offset`（下から上へ浮き上がる）で現れる
  - 句間に 0.3〜0.5 秒のディレイを設ける
  - 和歌の韻律を体感できる情緒的な演出
- カード全体の出現アニメーションは `opacity` のフェードイン（0.5 秒）
- アニメーション duration は 0.3〜0.5 秒程度（開発ガイドラインに準拠）

### FR-3: ローディング状態の表示

- 生成中は既存の `LoadingView` コンポーネントを表示する
- ローディング中は入力フォームは非表示にする
- メッセージは「短歌を詠んでいます...」（既存踏襲）

### FR-4: フィードに戻る導線

- 結果表示後、「フィードに戻る」ボタンを表示する
- タップすると NavigationPath をクリアし、フィード画面に戻る

### FR-5: 既存機能の維持

- 結果表示後、`TankaCard`（カードフリップ付き）が表示される
- `ShareButton`（共有ボタン）が利用できる
- 1日1回制限（`hasReachedDailyLimit`）が引き続き機能する
- レートリミットエラー時の表示も維持する

### FR-6: エラーハンドリング

- 生成エラー時はリトライボタン付きのエラー表示を行う
- リトライで再度生成を試みる
- レートリミットエラー時は専用メッセージを表示する

## 4. 非機能要件

### NFR-1: パフォーマンス

- アニメーションは 60fps を維持する
- 不要な View の再描画を避ける

### NFR-2: アクセシビリティ

- VoiceOver で状態遷移が通知される
- アニメーション軽減設定（`accessibilityReduceMotion`）を尊重する

## 5. 受け入れ条件

- [ ] 短歌生成後、ナビゲーション遷移ではなく同一画面内に結果が表示される
- [ ] 結果表示時にふわっとしたフェードイン等のアニメーションエフェクトがかかる
- [ ] 生成中のローディング状態が視覚的にわかる
- [ ] 結果表示後、フィードに戻る導線がある
- [ ] 既存の共有ボタン機能が引き続き利用できる
- [ ] 1日1回制限が引き続き機能する
- [ ] エラー時にリトライできる

## 6. 影響範囲

### 変更対象ファイル

| ファイル | 変更内容 |
|---|---|
| `ComposeView.swift` | 状態切り替え表示（入力 → ローディング → 結果）を追加 |
| `ComposeViewModel.swift` | 生成ロジック（`TankaResultViewModel` の責務を統合）を追加 |
| `FeedNavigationView.swift` | `tankaResult` ルートの削除 |
| `FeedRoute.swift` | `.tankaResult` ケースの削除 |
| `TankaResultView.swift` | 削除（ComposeView に統合） |
| `TankaResultViewModel.swift` | 削除（ComposeViewModel に統合） |

### 影響を受ける既存機能

- フィード画面からの短歌作成フロー
- 1日1回制限の管理
