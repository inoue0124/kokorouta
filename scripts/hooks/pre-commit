#!/bin/bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
REPO_DIR="$(cd "$SCRIPT_DIR/../.." && pwd)"

# Run lint only on staged Swift files
STAGED_SWIFT_FILES=$(git diff --cached --name-only --diff-filter=ACM -- '*.swift' || true)

if [ -z "$STAGED_SWIFT_FILES" ]; then
    exit 0
fi

echo "pre-commit: SwiftFormat + SwiftLint を実行しています..."

# Run lint script
if ! "$REPO_DIR/scripts/lint.sh"; then
    echo ""
    echo "pre-commit: lint エラーがあります。修正してから再度コミットしてください。"
    exit 1
fi
